---
import Layout from '../../layouts/layout.astro';
import { kv } from "@vercel/kv";

const { token } = Astro.params;

if (!token) {
  return Astro.redirect('/404');
}

// Hae jaettu kuva Redisistä
const shareData = await kv.get(`share:${token}`);

if (!shareData || typeof shareData !== 'object' || !('sharedUrl' in shareData)) {
  return Astro.redirect('/404');
}

const sharedUrl = (shareData as any).sharedUrl as string;
const originalUrl = (shareData as any).originalUrl as string;
---

<Layout title="Katso AI-muotokuva | Muotokuvasi.fi" description="Katso ammattimainen AI-muotokuva luotuna Muotokuvasi.fi -palvelussa.">
  <main class="min-h-screen flex flex-col items-center justify-center p-4 bg-[#F2F0ED]">
    <div class="bg-white p-8 rounded-[28px] shadow-sm max-w-lg w-full text-center space-y-6">
      
      <div class="w-16 h-16 bg-violet-100 text-violet-600 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
      </div>
      
      <h1 class="text-2xl font-bold text-gray-900">Katso AI-muotokuva</h1>
      <p class="text-gray-600">Tämä kuva on luotu <a href="https://muotokuvasi.fi" class="text-violet-600 hover:underline font-medium">Muotokuvasi.fi</a> -palvelussa.</p>
      
      <div class="rounded-xl overflow-hidden shadow-lg border-4 border-white my-6">
        <img src={sharedUrl} alt="Jaettu muotokuva" class="w-full h-auto" />
      </div>

      <div class="space-y-4">
        <h2 class="text-lg font-semibold text-gray-900">Tykkäsitkö kuvasta?</h2>
        <p class="text-gray-600">Tee oma ammattimainen AI-muotokuva vain 7,90€</p>
        
        <a 
          href="/" 
          class="block w-full py-4 bg-violet-600 text-white text-center rounded-full font-medium hover:bg-violet-700 transition shadow-md hover:shadow-lg"
        >
          Luo oma kuvasi →
        </a>
      </div>

      <p class="text-xs text-gray-400 mt-6">
        Tämä kuva poistetaan 7 päivän kuluttua.
      </p>
    </div>
  </main>
</Layout>
